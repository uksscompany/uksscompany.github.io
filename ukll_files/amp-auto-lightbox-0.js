(self.AMP=self.AMP||[]).push({n:"amp-auto-lightbox",v:"2007040248002",f:(function(AMP,_){
function m(a){for(var b=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global],c=0;c<b.length;++c){var h=b[c];if(h&&h.Math==Math)return}(function(){throw Error("Cannot find global object");})()}m(this);"function"===typeof Symbol&&Symbol("x");var n;function p(){var a,b;this.promise=new Promise(function(c,h){a=c;b=h});this.resolve=a;this.reject=b};function q(a,b){b=void 0===b?"":b;try{return decodeURIComponent(a)}catch(c){return b}};var r=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;function t(a){return a?Array.prototype.slice.call(a):[]};var u=self.AMP_CONFIG||{},v=("string"==typeof u.cdnProxyRegex?new RegExp(u.cdnProxyRegex):u.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function w(a){if(self.document&&self.document.head&&(!self.location||!v.test(self.location.origin))){var b=self.document.head.querySelector('meta[name="'+a+'"]');b&&b.getAttribute("content")}}u.cdnUrl||w("runtime-host");u.geoApiUrl||w("amp-geo-api");self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var x=self.__AMP_LOG;function y(){if(x.dev)return x.dev;throw Error("failed to call initLogConstructor");};var z=Object.prototype.hasOwnProperty;(function(a){return a||{}})({c:!0,v:!0,a:!0,ad:!0,action:!0});function A(a){if(a.__AMP__EXPERIMENT_TOGGLES)return a.__AMP__EXPERIMENT_TOGGLES;a.__AMP__EXPERIMENT_TOGGLES=Object.create(null);var b=a.__AMP__EXPERIMENT_TOGGLES;if(a.AMP_CONFIG)for(var c in a.AMP_CONFIG){var h=a.AMP_CONFIG[c];"number"===typeof h&&0<=h&&1>=h&&(b[c]=Math.random()<h)}if(a.AMP_CONFIG&&Array.isArray(a.AMP_CONFIG["allow-doc-opt-in"])&&0<a.AMP_CONFIG["allow-doc-opt-in"].length){var l=a.AMP_CONFIG["allow-doc-opt-in"],k=a.document.head.querySelector('meta[name="amp-experiments-opt-in"]');
if(k){var f=k.getAttribute("content").split(",");for(c=0;c<f.length;c++)-1!=l.indexOf(f[c])&&(b[f[c]]=!0)}}Object.assign(b,B(a));if(a.AMP_CONFIG&&Array.isArray(a.AMP_CONFIG["allow-url-opt-in"])&&0<a.AMP_CONFIG["allow-url-opt-in"].length){c=a.AMP_CONFIG["allow-url-opt-in"];var d=a.location.originalHash||a.location.hash;a=Object.create(null);if(d)for(var g;g=r.exec(d);){var e=q(g[1],g[1]);g=g[2]?q(g[2].replace(/\+/g," "),g[2]):"";a[e]=g}for(d=0;d<c.length;d++)e=a["e-"+c[d]],"1"==e&&(b[c[d]]=!0),"0"==
e&&(b[c[d]]=!1)}return b}function B(a){var b="";try{"localStorage"in a&&(b=a.localStorage.getItem("amp-experiment-toggles"))}catch(l){y().warn("EXPERIMENTS","Failed to retrieve experiments from localStorage.")}var c=b?b.split(/\s*,\s*/g):[];a=Object.create(null);for(var h=0;h<c.length;h++)0!=c[h].length&&("-"==c[h][0]?a[c[h].substr(1)]=!1:a[c[h]]=!0);return a};var C={},D=(C["ampdoc-fie"]={isTrafficEligible:function(){return!0},branches:[["21065001"],["21065002"]]},C);function E(a,b){a=a.__AMP_TOP||(a.__AMP_TOP=a);return F(a,b)}function G(a,b){var c=H(a);c=I(c);return F(c,b)}function H(a){return a.nodeType?E((a.ownerDocument||a).defaultView,"ampdoc").getAmpDoc(a):a}function I(a){a=H(a);return a.isSingleDoc()?a.win:a}function F(a,b){J(a,b);var c=a.__AMP_SERVICES;c||(c=a.__AMP_SERVICES={});a=c[b];a.obj||(a.obj=new a.ctor(a.context),a.ctor=null,a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}
function J(a,b){a=a.__AMP_SERVICES&&a.__AMP_SERVICES[b];return!(!a||!a.ctor&&!a.obj)};/*
 https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
function K(a,b){for(;a&&void 0!==a;a=a.parentElement)if(b(a))return a;return null}
function L(a){return a.closest?a.closest("a[href],amp-script,amp-story,button,amp-lightbox,amp-carousel,[placeholder],[data-amp-auto-lightbox-disable],amp-selector [option],[subscriptions-action]"):K(a,function(a){var b=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.msMatchesSelector||a.oMatchesSelector;return b?b.call(a,"a[href],amp-script,amp-story,button,amp-lightbox,amp-carousel,[placeholder],[data-amp-auto-lightbox-disable],amp-selector [option],[subscriptions-action]"):!1})}
function M(a){var b=a.tagName;4>b.length||b.lastIndexOf("AMP-",0);if(a.createdCallback)return Promise.resolve(a);a.__AMP_UPG_PRM||(b=new p,a.__AMP_UPG_PRM=b.promise,a.__AMP_UPG_RES=b.resolve);return a.__AMP_UPG_PRM};/nochunking=1/.test(self.location.hash);(function(){return n?n:n=Promise.resolve(void 0)})();var N={Article:!0,NewsArticle:!0,BlogPosting:!0,LiveBlogPosting:!0,DiscussionForumPosting:!0};function O(){}var P=/\s+([0-9]+)w(,|[\S\s]*$)/g;function Q(a){return G(a,"mutator").mutateElement(a,function(){a.setAttribute("i-amphtml-auto-lightbox-visited","")})}function R(a){return M(a).then(function(a){return a.signals().whenSignal("load-end")})}
function S(a){return t(a.getRootNode().querySelectorAll('script[type="application/ld+json"]')).map(function(a){try{var b=JSON.parse(a.textContent)}catch(h){b=null}return(b||{})["@type"]}).filter(function(a){return a})}function T(a){return S(a).some(function(a){return N[a]})}function U(a){function b(b){return!!a.getRootNode().querySelector(b)}return b('script[custom-element="amp-lightbox-gallery"]')&&b("[lightbox]:not([i-amphtml-auto-lightbox-visited])")}var V=0;
function W(a,b){return G(a,"mutator").mutateElement(b,function(){b.setAttribute("lightbox","i-amphtml-auto-lightbox-"+V++)}).then(function(){E(a.win,"extensions").installExtensionForDoc(a,"amp-lightbox-gallery");b.dispatchCustomEvent("amp-auto-lightbox:newly-set");return b})}
function X(a,b){b.map(function(b){return R(b).then(function(){var c;if(c=!b.signals().get("unload")){var l=b.querySelector("img");c=l.naturalWidth;var k=l.naturalHeight;var f=c/k;var d=-1;if(l=l.getAttribute("srcset"))for(var g;g=P.exec(l);)g=parseInt(g[1],10),g>d&&(d=g);k=d>c?{naturalWidth:d,naturalHeight:d/f}:{naturalWidth:c,naturalHeight:k};c=k.naturalWidth;k=k.naturalHeight;d=b.getLayoutBox();f=d.width;l=d.height;g=G(b,"viewport").getSize();d=g.width;g=g.height;f*=l;if(c=1.2<=c*k/f||c>d||k>g||
.25<=f/(d*g)){if(L(b))var e=!1;else{c=b.ownerDocument.defaultView;f=c.__AMP_TOP||(c.__AMP_TOP=c);k=c!=f;if(A(f)["ampdoc-fie"]){f.__AMP_EXPERIMENT_BRANCHES=f.__AMP_EXPERIMENT_BRANCHES||{};for(e in D)if(z.call(D,e)&&!z.call(f.__AMP_EXPERIMENT_BRANCHES,e))if(D[e].isTrafficEligible&&D[e].isTrafficEligible(f)){if(d=!f.__AMP_EXPERIMENT_BRANCHES[e])d=e,d=!!A(f)[d];d&&(d=D[e].branches,f.__AMP_EXPERIMENT_BRANCHES[e]=d[Math.floor(Math.random()*d.length)]||null)}else f.__AMP_EXPERIMENT_BRANCHES[e]=null;e="21065002"===
(f.__AMP_EXPERIMENT_BRANCHES?f.__AMP_EXPERIMENT_BRANCHES["ampdoc-fie"]:null)}else e=!1;k&&!e?e=J(c,"action")?F(c,"action"):null:(e=H(b),e=I(e),e=J(e,"action")?F(e,"action"):null);e=!e.hasResolvableAction(b,"tap")}c=e}}if(c)return y().info("amp-auto-lightbox","apply",b),W(a,b)},O)})}
function Y(a,b){if(U(a))var c=0;else c=(c=a.getRootNode().querySelector('meta[property="og:type"]'))?c.getAttribute("content"):void 0,c="article"==c||T(a);c?(c=t((b||a.win.document).querySelectorAll("amp-img:not([lightbox]):not([i-amphtml-auto-lightbox-visited])")),c.forEach(Q),X(a,c)):y().info("amp-auto-lightbox","disabled")}(function(a){var b=a.ampdoc;b.whenReady().then(function(){b.getRootNode().addEventListener("amp:dom-update",function(a){Y(b,a.target)});Y(b)})})(self.AMP);
})});

//# sourceMappingURL=amp-auto-lightbox-0.1.js.map
